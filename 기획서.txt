IT자산장부
사내 IT 자산 대여·반납·검수·통합관리 프로세스 DB 설계

1. 프로젝트 개요
사내 IT 자산(노트북/모니터/태블릿/모바일 단말 등)의 등록 → 할당/출고 → 반납요청 → 회수 → 검수 → 수리(필요 시) → 가용 복귀 전 과정을 단일 데이터 모델로 관리한다.
본 프로젝트는 정산/금액 처리 없이, due_date(반납예정일) 경과 기반의 반납관리(요구/경고/제재) 이력 통제로 미반납/지연 반납을 구조적으로 줄이고, 모든 판단을 근거가 남는 이력으로 재현 가능하게 만드는 것을 목표로 한다.

[이력 기반 보장 항목]
- 누가 어떤 자산을 언제부터 사용(배정/출고)했는지
- 반납 검수 결과와 증빙(사진/파일/메모)이 무엇인지
- 반납예정일 경과 시 요구/경고/제재가 언제 어떤 근거로 발생했는지

2. 서비스 목표
- 라이프사이클 표준화: 등록/할당/출고/반납요청/검수/수리/가용복귀 상태 전이를 데이터로 강제
- 미반납 통제: due_date 경과 기반 요구/경고/제재를 이력으로 남겨 운영 누락 방지
- 운영 리스크 감소: 분실/중복 지급/재고 불일치 및 검수 기준 불일치 최소화
- 근거 기반 추적: 검수 결과·증빙·요구/경고 메시지·제재 이력 간 참조 관계 유지

3. 사용자(역할) 정의
- 임차사 담당자(사용자): 자산 대여 확인, 반납요청 등록, 요구/경고 메시지 확인
- 렌탈 담당자: 렌탈 계약 생성, 자산 할당/출고 처리, 반납예정일(due_date) 설정/확정
- 자산관리자: 자산 등록/상태 관리, 회수 처리, 반납검수 및 증빙 등록, 수리 처리 및 가용 복귀
- 운영 관리자(정책): 반납관리 정책(요구/경고/제재 기준) 설정 및 모니터링 운영

4. 업무 범위(MVP) 및 제외 범위
[MVP 포함]
- (공통) 회원가입/로그인, 역할 선택
- 자산 마스터 등록 및 상태 관리
- 렌탈 계약 생성(업무 시작점), 자산 할당(ASSIGNED) 및 출고(OUT), due_date 설정/변경 이력
- 임차사 반납요청(RETURN_REQUESTED)
- 회수 처리, 반납검수(INSPECTING) 및 증빙 첨부(사진/파일/메모)
- 검수 결과 수리 필요 여부(repair_required) 판정 및 수리 진행 이력(진행/완료)
- due_date 경과 기반 반납관리(요구/경고/제재) 이력 관리 및 모니터링 종료(검수 완료 시)

[제외(명시)]
- 금액 산정/정산 기능 전부(연체료/수리비/보증금/차감/환급 등 일체)
- 회계/세무 연계, 결제/청구 연계
- 외부 솔루션(메신저/메일) 실연동(필요 시 “알림 로그 생성”까지만)
- 조달(PO/배송/입고) 프로세스

5. 핵심 용어 및 코드 통일
[용어 통일]
- due_date: 반납예정일
- return_request: 반납요청(사용자가 반납 의사를 등록한 이벤트)
- inspection: 반납검수(회수 후 상태 확인 및 증빙 등록)
- repair_required: 검수 결과 수리 필요 여부(Y/N) — 상태 코드가 아니라 검수 결과 속성
- overdue_count: 미반납 누적 횟수(사용자 단위 누적)
- warning_count: 경고 누적 횟수(사용자 단위 누적)
- restriction_level: 제재 단계(정책 값, 사용자 단위 관리)

[상태 코드 통일(자산 상태: 단일 세트)]
- AVAILABLE: 가용(대여 가능)
- ASSIGNED: 할당됨(출고 전 배정)
- OUT: 대여중(출고 완료, 사용 중)
- RETURN_REQUESTED: 반납요청(회수 대기)
- INSPECTING: 검수중(회수 완료, 검수 진행)
- UNDER_REPAIR: 수리중(수리 진행)
- DISPOSED: 폐기(종결 상태)

[상태 전이 원칙(요약)]
- OUT → RETURN_REQUESTED → INSPECTING → (AVAILABLE 또는 UNDER_REPAIR) → AVAILABLE
- repair_required=Y인 경우에만 UNDER_REPAIR로 전환한다(별도 상태값 “REPAIR_REQUIRED”는 사용하지 않는다).

6. 요구사항 ID 규칙 및 목록(시나리오 기반 최소 세트)
[규칙]
- 형식: <domain>_<action>[_detail]
- 원칙: 번호형(ID_001 등) 금지, 동사 기반, 1요구사항=1ID(중복 의미 금지)

[회원/인증]
- auth_terms_agree, auth_sign_up, auth_sign_in, auth_role_select, auth_sign_out

[자산]
- asset_create, asset_identifier_register, asset_status_update
- asset_list, asset_detail

[렌탈(대여/출고)]
- rental_contract_create
- asset_assign
- asset_checkout
- lend_due_date_set_update

[반납/검수/수리]
- return_request_create
- return_collect
- inspect_create
- inspect_evidence_attach
- repair_start
- repair_complete

[반납관리(정책/시스템)]
- policy_return_rules_upsert
- monitor_lent_assets
- check_due_date_overdue
- notice_generate_request
- notice_generate_warning
- penalty_overdue_count_increment
- restrict_apply_or_release
- notice_inbox_view
- close_monitoring_on_inspection_complete

7. 핵심 프로세스(요약, 시나리오 매핑)
0) 회원/역할
- 서비스 접속 → 회원유무 판단 → (비회원) 이용약관 동의/회원가입 → 로그인 → 역할 선택

1) 자산 등록(asset_create / asset_identifier_register)
- 자산관리자가 자산 마스터를 등록하고, 자산번호/시리얼/태그 등 식별값의 중복을 방지한다.
- 초기 상태는 AVAILABLE로 시작한다.

2) 렌탈 계약 및 할당/출고(rental_contract_create / asset_assign / asset_checkout / lend_due_date_set_update)
- 렌탈 담당자가 렌탈 계약을 생성한다.
- 자산을 사용자에게 할당하여 상태를 ASSIGNED로 전환한다.
- 물리 출고 시 OUT으로 전환하고 due_date를 설정/확정한다.
- due_date 변경은 변경 전/후/사유/처리자 이력으로 남긴다.

3) 사용자 대여 확인 및 반납요청(asset_detail / return_request_create)
- 임차사 담당자는 대여 상태를 확인한다.
- 반납 시 반납요청을 등록하여 상태를 RETURN_REQUESTED로 전환한다.

4) 회수 및 검수(return_collect / inspect_create / inspect_evidence_attach)
- 자산관리자가 회수 처리 후 검수(INSPECTING)를 등록한다.
- 검수 결과로 repair_required(Y/N)와 증빙(사진/파일/메모)을 다건 등록한다.
- repair_required=N이면 AVAILABLE로 복귀한다.
- repair_required=Y이면 UNDER_REPAIR로 전환하고 수리 이력을 생성한다.

5) 수리 및 가용 복귀(repair_start / repair_complete)
- 수리 진행/완료 이력만 관리한다.
- 수리 완료 시 AVAILABLE로 복귀한다.

6) 반납관리(시스템)(monitor_lent_assets / check_due_date_overdue / notice_generate_* / penalty_* / restrict_* / close_monitoring_*)
- 시스템은 대여 상태(ASSIGNED/OUT) 자산을 모니터링한다.
- 현재일 기준 due_date 경과 여부를 판단한다.
- 경과 시 반납 요구 메시지 로그를 생성한다.
- 정책 기준으로 미반납 누적(overdue_count)을 갱신한다.
- 누적 기준 충족 시 경고 메시지 로그를 생성하고, 필요 시 제재를 적용/해제한다(제재 적용은 정책/운영 선택).
- 검수 완료(반납 처리 종결) 시 모니터링을 종료한다.

8. 반납관리 정책(요구/경고/제재)
[기본 개념]
- 트리거: due_date 경과
- 결과물: 요구/경고/제재는 모두 “알림/제재 로그”로 남긴다.
- 근거 고정: overdue_count, warning_count, restriction_level 등은 이벤트 발생 시점 값을 로그에 함께 저장한다.

[정책 설정(policy_return_rules_upsert)]
- 요구/경고/제재 기준(경과 일수, 누적 기준, 제재 단계)을 테이블로 관리한다.

[제재 원칙(restrict_apply_or_release)]
- 요구/경고 로그 없이 제재 상승을 금지한다(정책 예외가 있으면 예외 플래그 및 근거 로그를 남긴다).

9. 데이터 설계 원칙(감점 포인트 방지)
- 상태 역전 방지: 검수 없이 AVAILABLE 복귀 금지, 수리 이력 없이 UNDER_REPAIR 전환 금지
- 제재 근거 누락 방지: 요구/경고 로그 없이 제재 상승 금지(예외는 플래그/근거 로그로 고정)
- 증빙 분리: 검수 증빙(사진/파일/메모)은 별도 엔터티로 다건 첨부 가능하게 설계
- 이력 우선: 계약/할당/출고/반납요청/회수/검수/수리/요구/경고/제재는 이벤트(이력)로 관리하고, 현재 상태는 스냅샷으로 유지
- 코드/용어 단일화: 문서/요구사항/ERD/SQL 전 구간 동일 코드 사용(혼용 금지)

10. 주요 엔터티(테이블) 범위(초안)
[회원/권한]
- user, role, user_role(또는 user.role), auth_terms_agreement(옵션)

[자산]
- asset, asset_category

[렌탈/대여]
- rental_contract
- asset_assignment
- checkout_log(due_date 설정/변경 이력 포함)

[반납/검수/수리]
- return_request
- return_collect_log(또는 checkout_log와 분리)
- inspection
- inspection_evidence
- repair

[반납관리(정책/이력)]
- return_policy
- monitor_log
- notice_log(요구/경고)
- restriction_log(제재)
- user_penalty_status(사용자 누적 스냅샷)

11. 테스트 관점(요약)
[정상 플로우]
- AVAILABLE → ASSIGNED → OUT → RETURN_REQUESTED → INSPECTING → AVAILABLE

[수리 플로우]
- INSPECTING(repair_required=Y) → UNDER_REPAIR → AVAILABLE

[반납관리 플로우]
- due_date 경과 시 요구 로그 생성 → 누적 갱신 → (조건 충족 시) 경고 로그 및 제재 적용/해제 → 검수 완료 시 모니터링 종료

[무결성 차단 케이스]
- inspect_create 없이 AVAILABLE 복귀 시도 차단
- repair_start/repair 이력 없이 UNDER_REPAIR 전환 시도 차단
- notice_generate_request/notice_generate_warning 없이 restrict_apply_or_release로 제재 상승 시도 차단(정책 예외 없는 경우)
